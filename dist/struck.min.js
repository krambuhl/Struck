!function(t,n){if("function"==typeof define&&define.amd)define(["lodash","jquery","exports"],function(e,o,r){t.Struck=n(t,r,e,o)});else if("undefined"!=typeof exports){var e=require("lodash"),o=require("jquery");exports=n(t,exports,e,o)}else t.Struck=n(t,{},t._,t.jQuery)}(this,function(t,n,e){function o(t){return t.charAt(0).toUpperCase()+t.slice(1)}function r(t,n){var o=e.isFunction(n)?n.call(t):n;return e.isArray(o)?o:o.split(" ")}function i(t){return e.isFunction(t)?t():t}function s(){return e.find(arguments,function(t){return!e.isUndefined(t)})}return n.hook=function(){function t(t,n,e,o){t[n]&&t[n].call(t,e,o)}function n(n,r,i){var s=e.extend({},o,e.isFunction(r)?i:r);return function(){var o;return s.pre&&t(this,s.method,n,s.pre),e.isFunction(r)&&(o=r.apply(this,arguments)),t(this,s.method,n,s.prefix),s.post&&e.defer(t,this,s.method,n,s.post),o}}var o={prefix:"on",pre:"before",post:"after",method:"hook"};return n}(),n.extend=function(t,n){var o,r=this;o=t&&e.has(t,"constructor")?t.constructor:function(){return r.apply(this,arguments)},e.extend(o,r,n);var i=function(){this.constructor=o};return i.prototype=r.prototype,o.prototype=new i,t&&e.extend(o.prototype,t),o.__super__=r.prototype,o},n.BaseObject=function(){function t(t){this.coreConstructor(t),this.initialize()}function r(t,n){return e.reduce(n,function(n,e){return n[e]=t.get(e),n},{})}return t.prototype.initialize=n.hook("initialize",e.noop),t.prototype.coreConstructor=n.hook("coreConstructor",function(t){this.uid=e.uniqueId("uid"),this.options=e.extend({},t)}),t.prototype.destroy=n.hook("destroy",e.noop),t.prototype.hook=function(t,n){var r=e.rest(arguments,2),i=s(n,"on"),c=i+o(t);return this[c]?this[c].apply(this,r):void 0},t.prototype.get=n.hook("get",function(t){var n=e.toArray(arguments);return e.isArray(t)?r(this,t):n.length>1?r(this,n):this[t]}),t.prototype.set=n.hook("set",function(t,n){t=i(t),e.isObject(t)&&e.each(t,function(t,n){this.set(n,t)},this),this[t]=i(n)}),t.extend=n.extend,t.create=function(t,n){var o=this.extend(t);return new o(e.extend({},t,n))},t}(),n.EventObject=function(){"use strict";function t(t){return t=i(t),t&&!e.isArray(t)&&(t=t.split(" ")),t}function o(o,i){var s=i.obj,c=t(i.events),u=i.func,p=i.single?function(){u.apply(this,arguments),r(o,s,i.events,p)}:u;e.each(c,function(t){o._events.push({events:t,func:p,obj:s}),s instanceof jQuery?s[i.single?"one":"on"](t,p):s instanceof n.EventObject&&s.com[i.single?"once":"on"].call(s.com,t,p,i.context)})}function r(o,r,i,s){function c(t,n){t?u.push(n):p.push(n)}i=t(i);var u=[],p=[];e.each(o._events,function(t){e.each(i,function(n){s?c(t.obj===r&&t.events===n&&t.func===s,t):i&&c(t.obj===r&&t.events===n,t)})}),!r||i||s?i||(u=o._events):e.each(o._events,function(t){c(t.obj===r,t)}),o._events=p,e.each(u,function(t){t.obj instanceof jQuery?t.obj.off(t.events,t.func):t.obj instanceof n.EventObject&&t.obj.com.off(t.events,u.func)})}var c=n.BaseObject.extend();return c.prototype.coreConstructor=function(){this.com=n.Intercom.create(),n.BaseObject.prototype.coreConstructor.apply(this,arguments),this._events=[]},c.prototype.hook=function(t,e){var o="";void 0!==e&&"on"!==e&&(o=":"+e),n.BaseObject.prototype.hook.apply(this,arguments),this.com.emit(t+o,arguments)},c.prototype.listenTo=function(t,n,r,i){var c=e.chain(arguments).rest(4).first().value();return o(this,{obj:t,events:n,func:r,single:s(c&&c.single,!1),context:s(i,this)}),this},c.prototype.listenOnce=function(t,n,e,o){return this.listenTo(t,n,e,s(o,this),{single:!0})},c.prototype.stopListening=function(t,n,e){return r(this,t,n,e),this},c.prototype.trigger=function(t){return this.com.emit.apply(this.com,[t].concat(e.rest(arguments,1))),this},c.prototype.destroy=function(){return n.BaseObject.prototype.destroy.apply(this,arguments),this.stopListening(),e.defer(function(t){t.com.destroy(),delete t.com},this),this},c}(),n.Intercom=function(){function o(t,n,o,s){e.each(r(t,n),function(n){i(t,n,o,{single:s.single,context:s.context})})}function i(t,n,o,r){if(n||o){var i={name:n,callback:o};e.each(f,function(t){r[t]&&(i[t]=r[t])});var s=e.extend({},a,i);t.subscriptions.push(s)}}function c(t,n,o){return void 0===n?void u(t):void e.each(r(t,n),function(n){u(t,n,o)})}function u(t,n,o){var r=function(t){return o?t.name===n&&t.callback===o:n?t.name===n:!0};t.subscriptions=e.reject(t.subscriptions,r)}function p(t,n,e){n.callback.apply(n.context,e),n.single&&u(t,n.name,n.callback)}var a={single:!1,name:"all",callback:e.noop,context:t},f=e.keys(a),h=n.BaseObject.extend();return h.prototype.coreConstructor=function(){n.BaseObject.prototype.coreConstructor.apply(this,arguments),this.defaultSubscription=e.extend({},a,{context:this}),this.subscriptions=[]},h.prototype.on=function(t,n,e,r){return o(this,t,n,{single:s(r&&r.single,!1),context:e}),this},h.prototype.once=function(t,n,e){return this.on(t,n,e,{single:!0})},h.prototype.off=function(t,n){return c(this,t,n),this},h.prototype.emit=function(t){var n=e.rest(arguments,1),o=e.reduce(r(this,t),function(t,n){var o=e.filter(this.subscriptions,function(t){return t.name===n},this);return t.concat(o)},[],this);return o=e.unique(o),e.each(o,function(t){p(this,t,n)},this),this},h}(),n});
//# sourceMappingURL=struck.min.js.map