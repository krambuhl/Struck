!function(t,e){if("function"==typeof define&&define.amd)define(["lodash","jquery","exports"],function(n,i,o){t.Struck=e(t,o,n,i)});else if("undefined"!=typeof exports){var n=require("lodash"),i=require("jquery");exports=e(t,exports,n,i)}else t.Struck=e(t,{},t._,t.jQuery)}(this,function(t,e,n){function i(t){return t.charAt(0).toUpperCase()+t.slice(1)}function o(t,e){var i=r(t,e);return n.isArray(i)?i:i&&i.split(" ")}function r(t,e){return n.isFunction(t)?t.apply(e):t}function s(){return n.find(arguments,function(t){return!n.isUndefined(t)})}return e.hook=function(){function t(t,e,n){t[e]&&t[e].call(t,n.name,n.prefix,n.args)}function e(e,o,r){var s=n.extend({},i,n.isFunction(o)?r:o),c={name:e,prefix:s.prefix};return function(){var e,i=n.toArray(arguments),r=n.extend({},c,{args:i});return s.pre&&t(this,s.method,n.extend({},r,{prefix:s.pre})),n.isFunction(o)&&(e=o.apply(this,arguments)),t(this,s.method,r),s.post&&n.defer(t,this,s.method,n.extend({},r,{prefix:s.post})),e}}var i={prefix:"on",pre:"before",post:"after",method:"hook"};return e}(),e.extend=function(t,e){var i,o=this;i=t&&n.has(t,"constructor")?t.constructor:function(){return o.apply(this,arguments)},n.extend(i,o,e);var r=function(){this.constructor=i};return r.prototype=o.prototype,i.prototype=new r,t&&n.extend(i.prototype,t),i.__super__=o.prototype,i},e.BaseObject=function(){function t(t){this.initializeObject(t),this.initialize()}function o(t,e){return n.reduce(e,function(e,n){return e[n]=t.get(n),e},{})}return t.prototype.initializeObject=e.hook("initializeObject",function(t){return this.uid=n.uniqueId("uid"),this.options=n.extend({},t),this}),t.prototype.initialize=e.hook("initialize",n.noop),t.prototype.destroy=e.hook("destroy",n.noop),t.prototype.hook=function(t,e){var o=n.isUndefined(e)?n.rest(arguments):n.rest(arguments,2),r=s(e,"on"),c=r+i(t);return this[c]?this[c].apply(this,o):this},t.prototype.get=e.hook("get",function(t){var e=n.toArray(arguments);return n.isArray(t)?o(this,t):e.length>1?o(this,e):r(this[t],this)}),t.prototype.set=e.hook("set",function(t,e){return t=r(t),n.isObject(t)&&n.each(t,function(t,e){this.set(e,t)},this),this[t]=r(e,this),this}),t.extend=e.extend,t.create=function(t,e){var i=n.isUndefined(t)?this:this.extend(t);return new i(n.extend({},e))},t}(),e.EventObject=function(){"use strict";function t(t,r){var s=r.obj,c=o(r.events),u=r.func,a=r.single?function(){u.apply(this,arguments),i(t,s,r.events,a)}:u;n.each(c,function(i){t.listenedEvents.push({events:i,func:a,obj:s,context:r.context}),s instanceof jQuery?s[r.single?"one":"on"](i,n.bind(a,r.context)):s instanceof e.EventObject&&s.com[r.single?"once":"on"].call(s.com,i,a,r.context)})}function i(t,i,r,c,u){function a(t,e){t?p.push(e):f.push(e)}r=o(r);var p=[],f=[];n.each(t.listenedEvents,function(t){n.each(r,function(e){c?a(t.obj===i&&t.events===e&&t.func===c,t):r&&a(t.obj===i&&t.events===e,t)})}),r||c||!i?r||(p=t.listenedEvents):n.each(t.listenedEvents,function(t){a(t.obj===i,t)}),t.listenedEvents=f,console.log(p),n.each(p,function(t){t.obj instanceof jQuery?t.obj.off(t.events,n.bind(t.func,s(u,t.context))):t.obj instanceof e.EventObject&&t.obj.com.off(t.events,p.func)})}var r=e.BaseObject.extend();return r.prototype.initializeObject=function(){return this.com=e.Intercom.create(),e.BaseObject.prototype.initializeObject.apply(this,arguments),this.listenedEvents=[],this},r.prototype.hook=function(t,n,i){var o="";return void 0!==n&&"on"!==n&&(o=":"+n),e.BaseObject.prototype.hook.apply(this,arguments),this.com.emit.apply(this.com,[t+o].concat(i)),this},r.prototype.listenTo=function(e,i,o,r){var c=n.chain(arguments).rest(4).first().value();return t(this,{obj:e,events:i,func:o,single:s(c&&c.single,!1),context:s(r,this)}),this},r.prototype.listenOnce=function(t,e,n,i){return this.listenTo(t,e,n,i,{single:!0})},r.prototype.stopListening=function(t,e,n){return i(this,t,e,n),this},r.prototype.trigger=function(t){return this.com.emit.apply(this.com,[t].concat(n.rest(arguments,1))),this},r.prototype.destroy=function(){return e.BaseObject.prototype.destroy.apply(this,arguments),this.stopListening(),n.defer(function(t){t.com.destroy()},this),this},r}(),e.Intercom=function(){function i(t,e,i,s){n.each(o(e,t),function(e){r(t,e,i,{single:s.single,context:s.context})})}function r(t,e,i,o){if(e||i){var r={name:e,callback:i};n.each(f,function(t){o[t]&&(r[t]=o[t])});var s=n.extend({},p,r);t.subscriptions.push(s)}}function c(t,e,i){return void 0===e?void u(t):void n.each(o(e,t),function(e){u(t,e,i)})}function u(t,e,i){var o=function(t){return i?t.name===e&&t.callback===i:e?t.name===e:!0};t.subscriptions=n.reject(t.subscriptions,o)}function a(t,e,n){e.callback.apply(e.context,n),e.single&&u(t,e.name,e.callback)}var p={single:!1,name:"all",callback:n.noop,context:t},f=n.keys(p),h=e.BaseObject.extend();return h.prototype.initializeObject=function(){return e.BaseObject.prototype.initializeObject.apply(this,arguments),this.defaultSubscription=n.extend({},p,{context:this}),this.subscriptions=[],this},h.prototype.on=function(t,e,n,o){return i(this,t,e,{single:s(o&&o.single,!1),context:n}),this},h.prototype.once=function(t,e,n){return this.on(t,e,n,{single:!0})},h.prototype.off=function(t,e){return c(this,t,e),this},h.prototype.emit=function(t){var e=n.rest(arguments,1),i=n.reduce(o(t,this),function(t,e){var i=n.filter(this.subscriptions,function(t){return t.name===e},this);return t.concat(i)},[],this);return i=n.unique(i),n.each(i,function(t){a(this,t,e)},this),this},h}(),e});
//# sourceMappingURL=struck.min.js.map